"use strict";(self.webpackChunkglint_site=self.webpackChunkglint_site||[]).push([[665],{7665:(st,w,s)=>{s.r(w),s.d(w,{AccountModule:()=>ot});var T=s(4466),h=s(8755),r=s(3075),d=s(1135),b=s(515),f=s(262),p=s(1679),m=s(7573),t=s(5e3),x=s(520),_=s(7655),C=s(7455),c=s(9808),l=s(4106),Z=s(5245);function U(e,i){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," Email address incorrect "),t.qZA())}function y(e,i){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," Password incorrect "),t.qZA())}function S(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"form",4),t.NdJ("ngSubmit",function(){return t.CHM(n),t.oxw().login()}),t.TgZ(1,"mat-form-field",5)(2,"mat-label"),t._uU(3,"Email"),t.qZA(),t._UZ(4,"input",6),t.YNc(5,U,2,0,"mat-error",7),t.qZA(),t.TgZ(6,"mat-form-field",5)(7,"mat-label"),t._uU(8,"Password"),t.qZA(),t._UZ(9,"input",8),t.ALo(10,"async"),t.TgZ(11,"button",9),t.NdJ("click",function(){t.CHM(n);const a=t.oxw();return a.passwordHidden.next(!a.passwordHidden.value)}),t.ALo(12,"async"),t.TgZ(13,"mat-icon"),t._uU(14),t.qZA()(),t.YNc(15,y,2,0,"mat-error",7),t.qZA(),t.TgZ(16,"div")(17,"button",10),t._uU(18,"Create account"),t.qZA()()()}if(2&e){const n=t.oxw();t.xp6(4),t.Q6J("formControl",n.emailControl),t.xp6(1),t.Q6J("ngIf",n.emailControl.hasError("invalid")),t.xp6(4),t.Q6J("formControl",n.passwordControl),t.uIk("type",t.lcZ(10,7,n.passwordHidden)?"password":"text"),t.xp6(2),t.Q6J("title",t.lcZ(12,9,n.passwordHidden)?"Show":"Hide"),t.xp6(3),t.Oqu(n.passwordHidden.value?"visibility":"visibility_off"),t.xp6(1),t.Q6J("ngIf",n.passwordControl.hasError("invalid"))}}function E(e,i){1&e&&(t.TgZ(0,"h3"),t._uU(1,"Processing..."),t.qZA())}function M(e,i){1&e&&(t.TgZ(0,"h3"),t._uU(1," Logged in successfully!"),t._UZ(2,"br"),t._uU(3," Redirecting... "),t.qZA())}function J(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"h3")(1,"mat-icon",11),t._uU(2,"warning"),t.qZA(),t._UZ(3,"br"),t._uU(4," Sorry! Something went wrong."),t._UZ(5,"br"),t._uU(6," Please click "),t.TgZ(7,"span",12),t.NdJ("click",function(){return t.CHM(n),t.oxw().reset()}),t._uU(8,"here"),t.qZA(),t._uU(9," to try again."),t._UZ(10,"br"),t._uU(11," If the problem persists please contact support at "),t.TgZ(12,"a",13),t._uU(13,"help@glint.info"),t.qZA(),t._uU(14,". "),t.qZA()}}let q=(()=>{class e{constructor(n,o){this.http=n,this.store=o,this.emailControl=new r.NI,this.passwordControl=new r.NI,this.view=new d.X("init"),this.passwordHidden=new d.X(!0)}login(){"processing"!==this.view.value&&(this.view.next("processing"),this.http.post(`${p.R}/auth/email/login`,{email:this.emailControl.value,password:this.passwordControl.value}).pipe((0,f.K)(n=>("invalid"===n.reason?(this.emailControl.setErrors({invalid:!0}),this.passwordControl.setErrors({invalid:!0}),this.view.next("init")):this.view.next("error"),b.E))).subscribe(({user:n})=>{this.store.dispatch(new m.Rl(n)),this.view.next("success")}))}reset(){this.emailControl.reset(),this.passwordControl.reset(),this.view.next("init")}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(x.eN),t.Y36(_.yh))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],decls:9,vars:7,consts:[[1,"mat-display-2","title"],[3,"ngSwitch"],[3,"ngSubmit",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"ngSubmit"],["appearance","outline",1,"form-field"],["type","email","matInput","","required","","placeholder","Enter your email address...",3,"formControl"],[4,"ngIf"],["matInput","","required","","placeholder","Enter your password...",3,"formControl"],["type","button","matSuffix","","mat-icon-button","",3,"title","click"],["type","submit","mat-stroked-button","",1,"submit-btn"],["color","warn",1,"error-icon"],[1,"reset",3,"click"],["href","mailto:help@glint.info"]],template:function(n,o){1&n&&(t.TgZ(0,"app-container")(1,"header",0),t._uU(2,"Login"),t.qZA(),t.ynx(3,1),t.ALo(4,"async"),t.YNc(5,S,19,11,"form",2),t.YNc(6,E,2,0,"h3",3),t.YNc(7,M,4,0,"h3",3),t.YNc(8,J,15,0,"h3",3),t.BQk(),t.qZA()),2&n&&(t.xp6(3),t.Q6J("ngSwitch",t.lcZ(4,5,o.view)),t.xp6(2),t.Q6J("ngSwitchCase","init"),t.xp6(1),t.Q6J("ngSwitchCase","processing"),t.xp6(1),t.Q6J("ngSwitchCase","success"),t.xp6(1),t.Q6J("ngSwitchCase","error"))},directives:[C.e,c.RF,c.n9,r._Y,r.JL,r.F,l.KE,l.hX,r.Fj,r.Q7,r.JJ,r.oH,c.O5,l.TO,l.R9,Z.Hw],pipes:[c.Ov],styles:["[_nghost-%COMP%]{display:block;padding-top:40px;text-align:center}",".title[_ngcontent-%COMP%]{margin-bottom:50px}","form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}",".form-field[_ngcontent-%COMP%]{min-width:250px;max-width:400px;width:100%;margin-bottom:10px}","a[_ngcontent-%COMP%], .reset[_ngcontent-%COMP%]{color:#78909c}",".submit-btn[_ngcontent-%COMP%]{margin-top:10px}",".error-icon[_ngcontent-%COMP%]{font-size:48px}"],changeDetection:0}),e})();function O(e,i){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," Please enter a valid email address "),t.qZA())}function P(e,i){1&e&&(t.TgZ(0,"mat-error"),t._uU(1," Please enter a strong password with these rules: "),t.qZA())}function N(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"form",4),t.NdJ("ngSubmit",function(){return t.CHM(n),t.oxw().register()}),t.TgZ(1,"mat-form-field",5)(2,"mat-label"),t._uU(3,"Email"),t.qZA(),t._UZ(4,"input",6),t.YNc(5,O,2,0,"mat-error",7),t.qZA(),t.TgZ(6,"mat-form-field",5)(7,"mat-label"),t._uU(8,"Password"),t.qZA(),t._UZ(9,"input",8),t.ALo(10,"async"),t.TgZ(11,"button",9),t.NdJ("click",function(){t.CHM(n);const a=t.oxw();return a.passwordHidden.next(!a.passwordHidden.value)}),t.ALo(12,"async"),t.TgZ(13,"mat-icon"),t._uU(14),t.qZA()(),t.YNc(15,P,2,0,"mat-error",7),t.qZA(),t.TgZ(16,"div")(17,"button",10),t._uU(18,"Create account"),t.qZA()()()}if(2&e){const n=t.oxw();t.xp6(4),t.Q6J("formControl",n.emailControl),t.xp6(1),t.Q6J("ngIf",n.emailControl.hasError("email")),t.xp6(4),t.Q6J("formControl",n.passwordControl),t.uIk("type",t.lcZ(10,7,n.passwordHidden)?"password":"text"),t.xp6(2),t.Q6J("title",t.lcZ(12,9,n.passwordHidden)?"Show":"Hide"),t.xp6(3),t.Oqu(n.passwordHidden.value?"visibility":"visibility_off"),t.xp6(1),t.Q6J("ngIf",n.passwordControl.hasError("pattern"))}}function H(e,i){1&e&&(t.TgZ(0,"h3"),t._uU(1,"Processing..."),t.qZA())}function I(e,i){1&e&&(t.TgZ(0,"h3"),t._uU(1," New account created!"),t._UZ(2,"br"),t._uU(3," Please click the link in your email to confirm your registration. "),t.qZA())}function Q(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"h3")(1,"mat-icon",11),t._uU(2,"warning"),t.qZA(),t._UZ(3,"br"),t._uU(4," Sorry! Something went wrong."),t._UZ(5,"br"),t._uU(6," Please click "),t.TgZ(7,"span",12),t.NdJ("click",function(){return t.CHM(n),t.oxw().reset()}),t._uU(8,"here"),t.qZA(),t._uU(9," to try again."),t._UZ(10,"br"),t._uU(11," If the problem persists please contact support at "),t.TgZ(12,"a",13),t._uU(13,"help@glint.info"),t.qZA(),t._uU(14,". "),t.qZA()}}let R=(()=>{class e{constructor(n,o){this.http=n,this.store=o,this.emailControl=new r.NI,this.passwordControl=new r.NI,this.view=new d.X("init"),this.passwordHidden=new d.X(!0)}register(){if("processing"===this.view.value)return;this.view.next("processing");const n=this.emailControl.value,o=this.passwordControl.value;this.http.post(`${p.R}/auth/email/register`,{email:n,password:o}).pipe((0,f.K)(()=>(this.view.next("error"),b.E))).subscribe(()=>{this.store.dispatch(new m.m3(n,o)).subscribe(()=>{}),this.view.next("success")})}reset(){this.emailControl.reset(),this.passwordControl.reset(),this.view.next("init")}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(x.eN),t.Y36(_.yh))},e.\u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],decls:9,vars:7,consts:[[1,"mat-display-2","title"],[3,"ngSwitch"],[3,"ngSubmit",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"ngSubmit"],["appearance","outline",1,"form-field"],["type","email","matInput","","required","","placeholder","Enter your email address...",3,"formControl"],[4,"ngIf"],["matInput","","required","","placeholder","Choose a password...",3,"formControl"],["type","button","matSuffix","","mat-icon-button","",3,"title","click"],["type","submit","mat-stroked-button","",1,"submit-btn"],["color","warn",1,"error-icon"],[1,"reset",3,"click"],["href","mailto:help@glint.info"]],template:function(n,o){1&n&&(t.TgZ(0,"app-container")(1,"header",0),t._uU(2,"Register"),t.qZA(),t.ynx(3,1),t.ALo(4,"async"),t.YNc(5,N,19,11,"form",2),t.YNc(6,H,2,0,"h3",3),t.YNc(7,I,4,0,"h3",3),t.YNc(8,Q,15,0,"h3",3),t.BQk(),t.qZA()),2&n&&(t.xp6(3),t.Q6J("ngSwitch",t.lcZ(4,5,o.view)),t.xp6(2),t.Q6J("ngSwitchCase","init"),t.xp6(1),t.Q6J("ngSwitchCase","processing"),t.xp6(1),t.Q6J("ngSwitchCase","success"),t.xp6(1),t.Q6J("ngSwitchCase","error"))},directives:[C.e,c.RF,c.n9,r._Y,r.JL,r.F,l.KE,l.hX,r.Fj,r.Q7,r.JJ,r.oH,c.O5,l.TO,l.R9,Z.Hw],pipes:[c.Ov],styles:["[_nghost-%COMP%]{display:block;padding-top:40px;text-align:center}",".title[_ngcontent-%COMP%]{margin-bottom:50px}","form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}",".form-field[_ngcontent-%COMP%]{min-width:250px;max-width:400px;width:100%;margin-bottom:10px}","a[_ngcontent-%COMP%], .reset[_ngcontent-%COMP%]{color:#78909c}",".submit-btn[_ngcontent-%COMP%]{margin-top:10px}",".error-icon[_ngcontent-%COMP%]{font-size:48px}"],changeDetection:0}),e})();var Y=s(655),L=s(7579),F=s(9841),k=s(3900),v=s(2843),z=s(2722),A=s(8746),j=s(7947),$=s(4004),X=s(9646);let B=(()=>{class e{constructor(n,o){this.http=n,this.store=o}getSubscriptions(){return this.http.get(`${p.R}/subscriptions`,{headers:this.getHeaders()})}purchaseSubscriptions(n,o){const a=this.store.selectSnapshot(m.jq.user);if(!a)throw new Error("Must be logged in to purchase subscriptions.");return this.http.post(`${p.R}/subscriptions/purchase`,{email:a.email,quantity:o,priceId:n},{headers:this.getHeaders()}).pipe((0,$.U)(()=>null),(0,f.K)(g=>303===g.status?(0,X.of)(g.url):(0,v._)(()=>g)))}assignSubscription(n){return this.http.post(`${p.R}/subscriptions/assign`,{email:n},{headers:this.getHeaders()})}unassignSubscription(n){return this.http.post(`${p.R}/subscriptions/unassign`,{email:n},{headers:this.getHeaders()})}getHeaders(){const n=this.store.selectSnapshot(m.jq.user);return n?{Authorization:`Bearer ${n.accessToken}`}:void 0}}return e.\u0275fac=function(n){return new(n||e)(t.LFG(x.eN),t.LFG(_.yh))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function D(e,i){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"date"),t.qZA()),2&e){const n=t.oxw(3);t.xp6(1),t.hij("(expires ",t.lcZ(2,1,n.bestSubscription.expiryDate),")")}}function K(e,i){if(1&e&&(t.TgZ(0,"h4"),t._uU(1),t.qZA()),2&e){const n=t.oxw(3);t.xp6(1),t.hij("Provided by ",n.bestSubscription.email,"")}}function G(e,i){if(1&e&&(t.ynx(0),t.TgZ(1,"h3"),t._uU(2),t.YNc(3,D,3,3,"span",1),t.qZA(),t.YNc(4,K,2,1,"h4",1),t.BQk()),2&e){const n=t.oxw().ngIf,o=t.oxw();t.xp6(2),t.hij(" Subscription: ",o.bestSubscription.accessLevel," "),t.xp6(1),t.Q6J("ngIf",!o.bestSubscription.autoRenew),t.xp6(1),t.Q6J("ngIf",o.bestSubscription.email!==n.email)}}function V(e,i){if(1&e&&(t.TgZ(0,"div",7),t._uU(1," You have "),t.TgZ(2,"span",8),t._uU(3),t.qZA(),t._uU(4," unassigned subscriptions. You can assign the remaining ones below, or cancel excess subscriptions. "),t.qZA()),2&e){const n=t.oxw(2);t.xp6(3),t.Oqu(n.totalPurchased-n.assigned.length)}}function W(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"li")(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"button",9),t.NdJ("click",function(){const g=t.CHM(n).$implicit;return t.oxw(2).unassign(g)}),t.TgZ(4,"mat-icon"),t._uU(5),t.qZA()()()}if(2&e){const n=i.$implicit;t.xp6(2),t.Oqu(n.email),t.xp6(3),t.Oqu(n.activated?"time":"delete")}}function tt(e,i){if(1&e){const n=t.EpF();t.TgZ(0,"main")(1,"h3"),t._uU(2),t.qZA(),t.YNc(3,G,5,3,"ng-container",1),t.TgZ(4,"button",2),t._uU(5,"Manage payments"),t.qZA(),t.YNc(6,V,5,1,"div",3),t.TgZ(7,"h3"),t._uU(8),t.qZA(),t.TgZ(9,"ul"),t.YNc(10,W,6,2,"li",4),t.qZA(),t.TgZ(11,"mat-form-field")(12,"mat-label"),t._uU(13,"User email"),t.qZA(),t._UZ(14,"input",5),t.TgZ(15,"button",6),t.NdJ("click",function(){return t.CHM(n),t.oxw().assign()}),t.TgZ(16,"mat-icon"),t._uU(17,"plus"),t.qZA(),t._uU(18," Assign "),t.qZA()()()}if(2&e){const n=i.ngIf,o=t.oxw();t.xp6(2),t.hij("You are logged in as: ",n.email,""),t.xp6(1),t.Q6J("ngIf",o.bestSubscription),t.xp6(3),t.Q6J("ngIf",o.totalPurchased>o.assigned.length),t.xp6(2),t.hij("Assigned subscriptions (",o.assigned.length,"):"),t.xp6(2),t.Q6J("ngForOf",o.assigned),t.xp6(4),t.Q6J("formControl",o.assignEmailControl)}}class u extends j.H{constructor(i,n,o){super(),this.cdr=i,this.router=n,this.api=o,this.totalPurchased=0,this.assigned=[],this.using=[],this.bestSubscription=null,this.assigning=!1,this.assignEmailControl=new r.NI(null,r.kI.email),this.refresh$=new L.x}ngOnInit(){(0,F.a)([this.user,this.refresh$]).pipe((0,k.w)(()=>this.api.getSubscriptions()),(0,f.K)(i=>(this.router.navigate(["/account/unauthorized"]),(0,v._)(()=>i))),(0,z.R)(this.destroyed$)).subscribe(({totalPurchased:i,assigned:n,using:o})=>{this.totalPurchased=i,this.assigned=n,this.using=o,this.bestSubscription=o.length>0?o[0]:null,this.cdr.markForCheck()})}assign(){this.assigning||(this.assigning=!0,this.api.assignSubscription(this.assignEmailControl.value).pipe((0,A.x)(()=>{this.assigning=!1})).subscribe(()=>{this.refresh$.next()}))}unassign(i){this.assigning||(this.assigning=!0,this.api.unassignSubscription(i.email).pipe((0,A.x)(()=>{this.assigning=!1})).subscribe(()=>{this.refresh$.next()}))}}u.\u0275fac=function(i){return new(i||u)(t.Y36(t.sBO),t.Y36(h.F0),t.Y36(B))},u.\u0275cmp=t.Xpm({type:u,selectors:[["ng-component"]],features:[t.qOj],decls:5,vars:3,consts:[[1,"mat-display-2","title"],[4,"ngIf"],["type","button","mat-button","","title","Click to change the number of subscriptions or to manage payments"],["class","warning",4,"ngIf"],[4,"ngFor","ngForOf"],["matInput","","type","email",3,"formControl"],["type","button","matSuffix","","mat-button","","title","Assign a subscription to this user",3,"click"],[1,"warning"],[1,"highlight"],["type","button","mat-icon-button","","title","Expire",3,"click"]],template:function(i,n){1&i&&(t.TgZ(0,"app-container")(1,"header",0),t._uU(2,"Your account"),t.qZA(),t.YNc(3,tt,19,6,"main",1),t.ALo(4,"async"),t.qZA()),2&i&&(t.xp6(3),t.Q6J("ngIf",t.lcZ(4,1,n.user)))},directives:[C.e,c.O5,c.sg,Z.Hw,l.KE,l.hX,r.Fj,r.JJ,r.oH,l.R9],pipes:[c.Ov,c.uU],styles:["[_nghost-%COMP%]{display:block;padding-top:40px;text-align:center}.title[_ngcontent-%COMP%]{margin-bottom:50px}"],changeDetection:0}),(0,Y.gn)([(0,_.Ph)(m.jq.user)],u.prototype,"user",void 0);const nt=function(){return["/account/login"]},et=[{path:"email/login",component:q,data:{title:"Login"}},{path:"email/register",component:R,data:{title:"Register"}},{path:"unauthorized",component:(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],decls:7,vars:2,consts:[[1,"mat-display-2","title"],[3,"routerLink"]],template:function(n,o){1&n&&(t.TgZ(0,"header",0),t._uU(1,"403 Unauthorized"),t.qZA(),t.TgZ(2,"h3"),t._uU(3,"Sorry! You are not authorized to view this page. Click "),t.TgZ(4,"a",1),t._uU(5,"here"),t.qZA(),t._uU(6," to login."),t.qZA()),2&n&&(t.xp6(4),t.Q6J("routerLink",t.DdM(1,nt)))},directives:[h.yS],styles:["[_nghost-%COMP%]{display:block;padding-top:40px;text-align:center}",".title[_ngcontent-%COMP%]{margin-bottom:50px}"],changeDetection:0}),e})(),data:{title:"Unauthorized"}},{path:"",component:u}];let it=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[h.Bz.forChild(et)],h.Bz]}),e})(),ot=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[T.m,it]]}),e})()}}]);